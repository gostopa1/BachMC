(
MIDIClient.init;
MIDIIn.connectAll;
//MIDIOut.connect[];

// Create task
t = Task({


	// Set attributes of each node
	// [freq, dur, [[next_state, weighted_random],ï¿½]]
	var node_list =[
[[83], 0.5 , 52.5 ,[[3,3],[33,1]],[3.33,0.11,0.08,1.52]],
[[81], 0.5 , 29.375 ,[[1,3],[7,1],[13,1],[21,2],[32,1]],[0.2,0.2,1.57,1.74,7.92,7.92,1.9,1.9]],
[[80], 0.5 , 31 ,[[4,2]],[1.27,2.74]],
[[79], 0.5 , 49.3125 ,[[0,3],[5,8],[32,3],[33,1],[50,1]],[0.38,1.31,2.86,1.35,1.47,1.24,1.5,1.71,2.85,1.6,2.89,1.19,1.59,2.71,0.13,1.11]],
[[78], 0.5 , 39.9167 ,[[2,2],[4,2],[6,1],[18,3],[21,2],[32,1],[38,1]],[1.28,0,0.16,1.24,1.26,0.27,1.89,3,4,1.94,1.09,0.5]],
[[77], 0.5 , 39.3571 ,[[3,6],[5,1],[6,4],[18,1],[24,1],[32,2],[33,5],[41,2],[50,6]],[3.14,1.35,0.38,2.92,1.34,1.33,0.16,1.48,1.71,0.29,0.11,0.11,1.38,0.13,1.42,1.23,0.57,0.66,1.26,2.9,0.22,0.11,0.76,2.61,0.42,0.23,1.11,0.32]],
[[76], 0.5 , 42.2727 ,[[4,2],[5,7],[6,3],[7,7],[9,4],[10,1],[18,5],[21,1],[24,1],[25,2],[30,1],[32,1],[33,2],[37,2],[41,1],[50,3],[52,1]],[0.3,1.36,0.38,1.52,1.29,0.1,2.9,1.69,0.37,1.47,2,0.22,0.11,0.23,1.36,1.6,0.23,1.34,1.35,1.71,0.21,1.29,1.22,2.38,0.27,1.39,0.3,0.51,0.54,0.6,0.42,0.37,1.28,2.21,0.42,0.33,4.58,1.34,0.5,0.98,1.94,0.48,0.5,1]],
[[75], 0.5 , 36.5882 ,[[4,3],[6,1],[7,3],[8,6],[9,3],[10,2],[13,3],[18,1],[28,1],[32,2],[33,3],[37,2],[41,1],[43,1],[47,1],[51,1]],[1.29,1.34,0.31,1.31,0.12,1.71,1.71,0.31,0.55,0.14,0.23,0.09,0.31,1.45,0.79,0.49,0.2,1.32,1.41,0.1,0.38,0.57,0.51,5.68,2.12,3.17,4,1.9,0.52,2.18,1.03,1.09,0.98,0.48]],
[[74], 0.5 , 38.6047 ,[[5,1],[6,4],[8,1],[10,15],[12,3],[13,1],[17,1],[18,1],[19,1],[21,1],[24,2],[33,6],[36,1],[37,3],[51,1],[52,1]],[0.42,1.58,0.31,1.26,0.59,1.48,1.33,1.24,1.23,0.31,0.15,0.17,1.69,0.08,1.35,0.11,0.27,0.27,0.13,1.4,0.31,0.31,1.4,1.71,0.09,1.29,1.52,0.27,1.89,3.13,2.72,2.78,0.3,0.72,1.19,0.34,0.38,1.66,2.49,1.31,1.25,6.38,1.38]],
[[73], 0.5 , 39.6154 ,[[6,2],[7,2],[8,2],[9,1],[10,4],[11,3],[12,3],[18,1],[19,3],[24,1],[26,1],[38,1],[39,1],[53,1]],[0.46,0.14,0.09,0.77,3.68,0.09,1.64,1.42,0.44,0.22,2.66,2.65,1.21,0.49,1.31,1.29,0.54,2.14,1.62,0.34,0.29,0.34,1.22,0.73,1.43,1.35]],
[[72], 0.5 , 37.8875 ,[[6,1],[7,10],[8,13],[10,8],[11,12],[12,1],[13,1],[14,1],[17,4],[18,2],[21,1],[22,1],[24,2],[26,1],[27,2],[29,1],[33,9],[38,1],[41,1],[43,1],[47,1],[48,1],[50,4],[52,1]],[1.33,0.87,0.32,0.12,1.38,0.3,0.92,0.11,2.6,1.59,0.12,0.27,0.14,1.64,0.38,1.71,3.21,0.41,1.5,0.16,0.11,1.23,0.58,1.3,0.06,1.21,0.27,2.49,0.43,0.4,0.1,0.07,3.73,0.95,0.1,1.36,1.35,0.57,3,1.38,1.39,1.39,0.27,0.12,1.44,2.87,0.31,1.49,0.4,1.36,0.1,0.1,0.47,1.42,0.07,0.11,0.14,1.28,0.11,0.27,0.1,1.48,1.42,0.44,0.31,0.33,0.4,1.57,2.19,1.22,1.17,1.15,3.18,1.1,3.28,12.19,4,0.5,1.53,0.98]],
[[71], 0.5 , 37.0986 ,[[8,6],[9,1],[10,3],[11,11],[12,1],[13,4],[14,3],[18,6],[19,2],[21,2],[22,1],[23,1],[24,1],[32,1],[33,4],[37,5],[38,1],[39,1],[41,1],[42,1],[47,1],[50,7],[51,2],[52,2],[53,2],[56,1]],[0.32,1.38,1.4,0.26,2.69,0.13,1.63,1.25,0.27,1.44,0.08,1.35,0.27,0.34,0.34,0.53,3.72,0.14,0.1,0.43,0.31,0.31,0.95,0.16,1.27,0.27,0.76,0.13,0.3,0.29,0.59,5.95,0.33,0.82,1.24,3.24,1.14,0.78,2.02,2.02,3.76,0.33,0.5,1.25,0.44,2.02,2.02,1.95,1.89,0.42,3.26,1.25,3.77,0.48,0.42,5.03,1.88,4.96,1.42,2.19,1.94,1.27,3.2,3.27,1.37,0.48,0.5,2,2.18,4.36,0.5]],
[[70], 0.5 , 39.05 ,[[9,2],[10,4],[11,4],[12,2],[13,6],[14,8],[15,5],[16,1],[26,1],[33,4],[37,1],[38,1],[41,2],[48,2],[49,1],[50,5],[51,4],[52,1],[53,1],[54,5]],[0.29,1.38,0.83,0.31,0.24,0.38,1.41,2.78,2.92,1.44,0.25,1.34,1.5,1.71,0.29,0.27,2.73,1.51,1.47,0.13,1.57,0.09,0.38,0.08,0.22,0.12,0.11,1.6,0.39,2.78,1.4,0.22,0.38,0.1,1.31,0.63,2.65,1.71,0.27,1.6,1.25,0.27,1.09,1.17,2.02,0.93,0.47,1.3,3.79,0.38,0.44,1.89,1.25,1.83,5.38,2.1,1.39,1.89,1.94,1.42]],
[[69], 0.5 , 41.7368 ,[[1,4],[4,1],[7,3],[11,2],[12,7],[13,3],[14,1],[18,1],[21,3],[24,2],[29,2],[34,2],[37,1],[43,1],[47,1],[52,3],[53,1]],[1.76,1.51,2.82,2.9,1.31,0.38,0.88,0.27,1.44,1.31,0.09,1.31,2.69,3.17,1.17,1.13,1.27,1.19,0.25,1.6,0.38,0.39,1.12,0.44,1.25,2.45,0.3,0.33,0.43,0.34,2,4,1.97,4,2,1.64,1.2,1.9]],
[[68], 0.5 , 35.1127 ,[[10,1],[11,4],[12,21],[13,1],[15,29],[17,3],[18,1],[29,1],[32,3],[39,1],[41,1],[50,1],[51,1],[54,3]],[1.38,1.33,0.46,0.29,0.29,0.81,2.74,0.09,1.54,0.27,1.26,1.66,0.31,1.44,1.26,0.13,0.27,1.49,0.41,0.09,0.44,0.08,1.28,1.57,0.24,1.42,1.4,0.31,0.11,1.29,0.27,0.25,1.37,2.71,0.31,1.33,2.63,3,0.11,0.87,3.02,0.94,2.82,0.29,3.04,1.34,2.87,1.24,0.07,0.22,2.93,1.2,1.5,0.08,0.39,0.4,0.27,1.46,1.26,0.31,1.24,1.61,1.57,2.02,1.12,3.47,1.53,1.11,1.94,1.1,3.31]],
[[67], 0.5 , 33.9865 ,[[11,2],[12,4],[14,8],[15,7],[16,5],[17,17],[19,1],[32,5],[33,14],[37,2],[39,1],[41,4],[45,2],[54,2]],[0.11,0.25,0.43,1.28,0.3,0.88,1.29,2.88,0.08,1.72,0.08,0.29,3.27,1.55,1.29,0.12,1.41,2.47,2.87,0.1,1.6,0.22,1.5,1.5,1.45,1.71,1.33,0,1.39,0.06,0.31,2.83,0.27,0.11,1.34,0.31,1.35,1.43,0.32,0.32,0.38,0.38,3.07,0.17,0.38,1.31,1.38,0.39,1.27,0.96,0.52,1.5,0.14,1.19,1.5,0.27,3.73,1.33,1.23,0.27,1.27,1.08,1,1.06,1.87,1.86,5.55,1.67,2.03,2.1,1.26,1.99,1.26,1.8]],
[[66], 0.5 , 38.7778 ,[[13,2],[15,7],[16,2],[18,3],[19,1],[28,1],[51,2]],[7.18,3,1,1.86,1.83,1.81,1.34,1.92,0.52,1.03,1.03,2.08,1.14,0.43,3.32,1.26,2.01,0.33]],
[[65], 0.5 , 42.7385 ,[[0,1],[3,2],[5,2],[10,1],[11,8],[14,3],[15,5],[22,2],[23,1],[24,2],[28,2],[32,7],[33,7],[37,2],[38,2],[39,1],[41,3],[45,1],[46,1],[47,3],[50,5],[51,2],[53,1],[54,1]],[0.3,0.38,0.3,1.34,0.1,1.33,1.53,3.12,0.12,0.61,0.29,0.38,1.44,0.1,0.52,0.08,1.46,3.1,0.22,0.09,0.89,0.07,3.68,1.64,1.6,2.61,0.11,2.98,1.31,0.29,2.56,1.28,0.54,1.51,1.29,1.26,0.13,0.4,0.58,1.87,0.5,3.21,0.36,0.48,0.79,0.48,0.32,2.17,1.9,0.43,0.35,0.64,1.96,1.9,1.16,5,4.49,1.9,5.95,1.94,1.49,5.07,1.05,1.24,4.21]],
[[64], 0.5 , 45.7455 ,[[6,4],[7,1],[8,1],[9,2],[10,1],[11,9],[12,2],[13,4],[16,2],[18,4],[19,2],[24,2],[37,10],[39,3],[47,1],[50,1],[51,2],[52,2],[56,1],[57,1]],[0.27,0.27,0.1,1.71,1.3,0.56,0.27,4.32,0.39,0.41,1.28,2.45,0.34,3.2,0.38,0.46,3.22,0.36,2.21,0.36,0.39,1.35,0.42,0.39,0.37,1.98,0.62,5.61,3.2,1.1,1.25,1.09,1.97,1.85,0.46,5.83,1.29,0.44,0.38,0.5,0.5,1.22,6.18,5.55,2.49,0.54,0.49,0.59,4,0.47,0.49,0.52,4.53,0.98,1.09]],
[[62], 0.5 , 42.4615 ,[[6,1],[8,1],[10,1],[11,2],[12,2],[15,1],[16,2],[28,1],[39,1],[51,1]],[0.86,0.59,6.38,1.16,3,0.49,3.21,6.26,0.97,1.6,0.34,1.99,4.69]],
[[60], 0.5 , 40.6667 ,[[5,1],[14,2]],[0.43,0.27,0.29]],
[[60,64], 0.5 , 35.375 ,[[1,1],[4,1],[6,1],[11,1],[13,4],[17,3],[18,1],[21,2],[37,1],[52,1]],[0.25,0.25,5.81,2.52,0.6,0.51,0.83,0.32,0.49,4,4.36,2.18,0.48,1,0.49,1.9]],
[[58,62,67], 0.5 , 38.3333 ,[[13,1],[15,1],[29,4]],[1.51,1.3,2.39,0.58,1.41,2.35]],
[[58,61,66], 0.5 , 21.75 ,[[15,1],[23,1],[49,1],[52,1]],[1.21,0.27,0.17,3.01]],
[[57,62], 0.5 , 36.6875 ,[[5,1],[6,1],[8,1],[9,1],[10,1],[11,1],[13,1],[17,2],[18,5],[51,1],[56,1]],[4.01,4.67,0.58,2.45,1.05,3.24,0.4,7.14,0.83,2.65,4,2.09,1.42,2.23,1,0.52]],
[[57,62,65], 0.5 , 22.3333 ,[[10,1],[25,1],[51,1]],[0.28,0.28,1.32]],
[[57,61], 0.5 , 24 ,[[6,1],[15,1],[18,1]],[0.27,2.14,1.74]],
[[57,61,64], 0.5 , 38.875 ,[[11,1],[12,1],[17,1],[23,1],[27,2],[48,1],[50,1]],[0.4,1.39,1.28,1.23,2.92,0.09,0.07,1.41]],
[[57,60], 0.5 , 31.2 ,[[8,1],[12,1],[14,1],[16,1],[17,2],[18,1],[19,1],[28,1]],[8.99,0.93,3,0.38,8.2,1.94,1.19,1.3,1.64,2]],
[[57,60,65], 0.5 , 31 ,[[8,1],[11,1],[12,2],[27,1],[29,1],[47,1],[51,1],[52,2]],[0.38,1.3,0.41,0.1,0.11,1.34,1.29,1.33,0.2,1.45]],
[[56], 0.5 , 43 ,[[20,3]],[0.43,0.27,0.29]],
[[56,62], 0.5 , 25.5 ,[[6,1],[43,1]],[1.3,0.23]],
[[56,60], 0.5 , 41.5429 ,[[4,1],[7,2],[8,1],[10,4],[11,1],[14,5],[15,1],[17,14],[18,1],[33,1],[47,1],[50,2],[51,1]],[0.3,1.39,1.27,2.79,0.12,0.38,0.12,1.6,2.42,1.37,0.11,0.41,0.41,0.56,2.15,1.35,1.26,1.71,1.34,0.38,1.34,1.6,1.34,1.17,1.97,1.27,1.87,1.67,1.46,1.07,4.14,7.92,1.09,0.48,1.64]],
[[56,60,65], 0.5 , 36.7071 ,[[3,2],[5,5],[6,5],[7,2],[8,3],[9,3],[10,16],[14,15],[15,5],[17,2],[33,13],[41,1],[46,1],[50,22],[54,3],[55,1]],[1.31,0.46,0.71,2.9,0.16,0.3,0.44,1.35,0.31,1.28,1.71,0.25,1.42,3.2,1.31,0.57,3.2,1.62,3.08,1.71,1.52,0.14,1.49,1.45,0.71,1.43,0.29,0.94,1.47,1.39,1.44,3,0.1,1.27,0.11,0.21,0.21,1.29,0.1,0.14,1.24,0.22,2.73,1.45,1.44,3.72,2.67,0.27,0.27,0.31,1.4,0.37,0.53,1.62,1.57,1.61,0.16,1.29,1.22,1.25,0.31,1.32,0.15,0.27,1.31,1.25,2.82,1.32,1.52,1.7,0.4,0.32,1.36,1.39,2.87,1.71,1.85,0.17,1.19,0.43,0.84,1.5,1.44,0.42,0.43,0.13,0.08,1.5,0.14,0.44,0.71,0.29,0.07,0.27,0.46,0.93,1.56,0.31,0.31]],
[[56,59], 0.5 , 33.5 ,[[14,1],[17,1]],[0.39,1.12]],
[[55,60,64], 0.5 , 44.5 ,[[35,1],[47,1]],[1.44,0.09]],
[[55,60,63], 0.5 , 98 ,[[6,1]],[1.35]],
[[55,59], 0.5 , 45.3243 ,[[6,3],[7,1],[9,5],[10,1],[11,1],[12,2],[16,2],[17,6],[18,10],[19,1],[28,1],[37,1],[47,1],[50,2]],[0.51,0.39,2.11,0.52,5.87,0.33,5,0.3,2.17,0.45,0.06,0.41,0.34,0.39,0.4,2.01,0.37,0.4,1.88,0.42,3.45,1.25,0.4,1.83,1.45,2.51,0.39,0.59,6.25,1.93,0.55,1.94,0.5,2.18,0.55,0.55,0.5]],
[[55,59,64], 0.5 , 35.1429 ,[[6,1],[10,1],[11,1],[12,1],[15,2],[17,1],[38,2],[43,1],[46,1],[47,2],[51,1]],[0.1,1.25,1.51,1.41,1.6,1.25,0.22,1.24,1.25,0.31,0.31,0.14,0.91,0.32]],
[[54,59], 0.5 , 38.5833 ,[[6,1],[12,3],[15,1],[16,3],[17,1],[18,1],[19,1],[52,1]],[0.42,0.49,3.75,1.28,1.95,1.06,1.44,0.57,1.18,1.23,1.5,0.47]],
[[53], 0.5 , 66 ,[[31,2]],[2.15,1.41]],
[[53,58,61], 0.5 , 40.9688 ,[[3,1],[8,2],[9,1],[10,3],[14,4],[15,2],[30,1],[32,1],[41,6],[48,1],[50,9],[54,1]],[0.29,1.51,0.41,0.87,1.43,0.29,3.19,0.11,0.16,1.27,0.09,0.25,0.53,1.29,0.27,1.26,0.31,0.1,0.08,0.25,1.24,0.07,0.22,1.42,0.29,3.18,2.84,1.57,0.31,3.42,0.12,0.11]],
[[53,57,60], 0.5 , 16.5 ,[[11,1],[38,1]],[0.34,0.27]],
[[53,56,62], 0.5 , 49.1111 ,[[6,2],[9,1],[12,1],[13,1],[43,1],[44,1],[47,2]],[1.26,1.42,0.24,0.09,2.67,2.46,1.28,0.09,1.25]],
[[52,55,59], 0.5 , 23 ,[[51,1]],[1.24]],
[[51,55,60], 0.5 , 37 ,[[14,1],[15,1],[45,1],[50,1]],[0.86,0.78,1.31,1.34]],
[[48], 0.5 , 30.3333 ,[[15,1],[17,1],[27,1]],[3.22,1.33,0.31]],
[[45], 0.5 , 45 ,[[10,1],[11,1],[17,2],[18,1],[27,1],[28,1],[32,1],[37,1],[38,1],[42,1],[43,2],[48,1],[51,2]],[0.27,0.53,1.5,3.77,2.89,1.48,0.22,0.53,0.19,3.89,0.55,7.15,1.93,4.8,1.2,0.5]],
[[43], 0.5 , 53 ,[[8,1],[10,1],[14,1],[22,1],[35,1],[41,1]],[1.38,0,1.45,1.43,1.43,2.72]],
[[42], 0.5 , 51 ,[[17,1],[27,1]],[2.24,0.14]],
[[41], 0.5 , 38.2817 ,[[3,2],[5,2],[6,2],[10,8],[11,1],[14,11],[15,1],[18,2],[29,1],[30,1],[32,4],[33,26],[37,2],[39,2],[41,6]],[3.51,0.32,1.36,0.41,0.88,1.39,1.3,0.13,0.16,0.23,1.62,0.12,0.19,0.15,0.29,3.25,0.29,0.49,0.11,0.29,0.58,0.13,1.47,1.29,1.56,0.21,1.47,1.5,2.83,0.54,1.52,0.31,0.21,0.79,0.27,0.08,2.74,1.33,0.41,3.77,0.87,1.71,0.1,0.13,1.28,0.25,0.26,0.11,0.34,1.32,1.34,1.62,0.09,1.5,1.3,0.23,0.13,1.46,0.83,1.52,3.11,0.27,0.07,1.39,0.1,0.65,2.06,0.71,1.91,1.92,0.35]],
[[40], 0.5 , 40.3333 ,[[7,1],[8,2],[9,1],[10,1],[11,1],[13,3],[14,1],[17,1],[18,2],[21,1],[22,1],[28,2],[32,1],[37,2],[38,2],[39,1],[40,1],[51,3]],[0.27,0.27,0.38,0.08,0.28,1.28,0.12,1.44,1.71,2.49,3,4.33,0.3,0.4,0.33,6.38,1.11,0.93,0.41,2.22,6.32,0.33,0.57,0.46,1.86,1.92,2.03]],
[[38], 0.5 , 52.4375 ,[[6,3],[7,1],[10,1],[11,1],[13,1],[14,1],[17,2],[18,1],[21,1],[37,1],[38,1],[40,1],[43,1]],[1.28,0.22,2.83,0.07,1.5,0.09,0.1,0.57,1.19,1.36,0.17,1.11,0.38,0.67,0.41,0.76]],
[[35], 0.5 , 32.8333 ,[[8,1],[11,2],[12,1],[24,1],[37,1]],[0.48,2.84,3.19,5,1.91,0.43]],
[[34], 0.5 , 42.9333 ,[[12,2],[14,3],[15,3],[32,2],[33,3],[41,2]],[0.29,1.4,0.1,0.31,0.39,1.42,0.25,1.39,0.59,0.11,1.28,1.33,0.86,1.32,0.29]],
[[34,41], 0.5 , 18 ,[[14,1]],[1.28]],
[[33], 0.5 , 32.6667 ,[[6,1],[9,1],[13,1]],[0.32,1.68,2.12]],
[[30], 0.5 , 59 ,[[24,1]],[0.43]]
];

	var node_index = 0;
	var bps = 60 / 60.0;  // Beats per second

	inf.do({

		var weight = 0;
		var random;
		var accumulator;
		var node = node_list[node_index];
		var temp=node[0];
		//var freq = node[0].midicps;
		//var dur = node[1] / bps;
		var dur = node[4][node[4].size.rand] / bps;
		var paths = node[3];
		var amp = node[2];

		// Get total statistical weight of connected nodes
		(0 .. paths.size - 1).do {|i| weight = weight + paths[i][1]};

		// Generate random value for choosing next node
		random = weight.rand;

		// Choose next node based on statistical weights
		accumulator = paths[0][1];

		node_index = block {|break|
			paths.size.do {|i|
				if ((random < accumulator), {
					break.value(paths[i][0])
					}, {
						accumulator = accumulator + paths[i + 1][1]
				})
			}
		};
m = MIDIOut(11);

		// Play
		//Synth(\my_synth, [\dur, dur, \amp, -3.dbamp, \freq, freq]);
		//Synth(\my_synth, [\dur, dur, \amp, amp/127.0, \freq, freq]);
		temp=node[0];
		//temp.postln;
		temp.size.do{|i| m.noteOn(16,temp[i] , amp);};
		temp.postln;
		node[0].postln;
		//m.noteOn(16, node[0], amp-50);
		//m.noteOn(16, 13, amp-50);
		//dur.wait+0.1.rand-0.05;
		dur.wait+0.1.rand-0.05;
		//m.noteOff(16, 13, amp-50);
		temp.size.do{|i|m.noteOff(16,temp[i] , amp-50);};
	})
});

t.start;

);

////c
//node_list[2].postln;


//m = MIDIOut(3)

//
//

//m.allNotesOff(16);


